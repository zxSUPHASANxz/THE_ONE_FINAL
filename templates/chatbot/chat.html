{% extends 'base.html' %}
{% load static %}

{% block title %}Chatbot - THE ONE{% endblock %}

{% block extra_css %}
<style>
    .chat-container {
        height: calc(100vh - 300px);
        min-height: 500px;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-6">
    <div class="card">
        <h2 class="text-2xl font-bold mb-4">Chatbot ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ã‡πà‡∏≠‡∏°‡∏£‡∏ñ</h2>
        <p class="text-gray-600 mb-6">‡∏ñ‡∏≤‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
        
        <!-- Chat Container -->
        <div x-data="chatApp()" class="border rounded-lg">
            <!-- Messages Area -->
            <div class="chat-container overflow-y-auto p-4 bg-gray-50" x-ref="chatContainer">
                <template x-for="message in messages" :key="message.id">
                    <div :class="message.sender === 'user' ? 'flex justify-end mb-4' : 'flex justify-start mb-4'">
                        <div :class="message.sender === 'user' ? 'bg-primary-600 text-white rounded-lg px-4 py-2 max-w-xs' : 'bg-white border rounded-lg px-4 py-2 max-w-xs'">
                            <p class="text-sm" x-text="message.text"></p>
                            <span class="text-xs opacity-75" x-text="message.time"></span>
                        </div>
                    </div>
                </template>
                
                <!-- Loading indicator -->
                <div x-show="loading" class="flex justify-start mb-4">
                    <div class="bg-white border rounded-lg px-4 py-2">
                        <div class="flex space-x-2">
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="border-t p-4 bg-white">
                <form @submit.prevent="sendMessage()" class="flex space-x-2">
                    <input type="text" 
                           x-model="newMessage"
                           placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." 
                           class="flex-1 input-field"
                           :disabled="loading">
                    <button type="submit" 
                            class="btn-primary"
                            :disabled="!newMessage.trim() || loading">
                        ‡∏™‡πà‡∏á
                    </button>
                </form>
                
                <!-- Quick Questions -->
                <div class="mt-4 flex flex-wrap gap-2">
                    <button @click="quickQuestion('‡∏£‡∏ñ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î')" 
                            class="text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full">
                        üîß ‡∏£‡∏ñ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î
                    </button>
                    <button @click="quickQuestion('‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á')" 
                            class="text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full">
                        üîä ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á
                    </button>
                    <button @click="quickQuestion('‡πÄ‡∏ö‡∏£‡∏Å‡∏≠‡πà‡∏≠‡∏ô')" 
                            class="text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full">
                        üõë ‡πÄ‡∏ö‡∏£‡∏Å‡∏≠‡πà‡∏≠‡∏ô
                    </button>
                    <button @click="quickQuestion('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ã‡πà‡∏≠‡∏°')" 
                            class="text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full">
                        üìÖ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ã‡πà‡∏≠‡∏°
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function chatApp() {
    return {
        messages: [
            {
                id: 1,
                sender: 'bot',
                text: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ã‡πà‡∏≠‡∏°‡∏£‡∏ñ ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?',
                time: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })
            }
        ],
        newMessage: '',
        loading: false,
        sessionId: null,
        
        init() {
            this.createSession();
        },
        
        async createSession() {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á chat session ‡πÉ‡∏´‡∏°‡πà
            this.sessionId = 'session_' + Date.now();
        },
        
        quickQuestion(question) {
            this.newMessage = question;
            this.sendMessage();
        },
        
        async sendMessage() {
            if (!this.newMessage.trim()) return;
            
            const userMessage = {
                id: Date.now(),
                sender: 'user',
                text: this.newMessage,
                time: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })
            };
            
            this.messages.push(userMessage);
            const messageText = this.newMessage;
            this.newMessage = '';
            this.loading = true;
            
            // Scroll to bottom
            this.$nextTick(() => {
                this.$refs.chatContainer.scrollTop = this.$refs.chatContainer.scrollHeight;
            });
            
            try {
                // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á API (‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ mock response)
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Mock bot response
                let botResponse = this.getMockResponse(messageText);
                
                this.messages.push({
                    id: Date.now(),
                    sender: 'bot',
                    text: botResponse,
                    time: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })
                });
                
            } catch (error) {
                this.messages.push({
                    id: Date.now(),
                    sender: 'bot',
                    text: '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    time: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })
                });
            } finally {
                this.loading = false;
                this.$nextTick(() => {
                    this.$refs.chatContainer.scrollTop = this.$refs.chatContainer.scrollHeight;
                });
            }
        },
        
        getMockResponse(message) {
            const msg = message.toLowerCase();
            
            if (msg.includes('‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó') || msg.includes('‡∏ï‡∏¥‡∏î')) {
                return '‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡∏ñ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏≠‡∏≤‡∏à‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ñ‡∏£‡∏±‡∏ö:\n\n1. ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏´‡∏°‡∏î\n2. ‡∏´‡∏±‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤\n3. ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏•\n\n‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö';
            }
            
            if (msg.includes('‡πÄ‡∏™‡∏µ‡∏¢‡∏á') || msg.includes('‡∏î‡∏±‡∏á')) {
                return '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å:\n\n1. ‡∏ó‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏£‡∏±‡πà‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏≥‡∏£‡∏∏‡∏î\n2. ‡πÇ‡∏ã‡πà‡∏≠‡∏≤‡∏à‡∏´‡∏•‡∏ß‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ\n3. ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏Ç‡∏≤‡∏î‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô\n\n‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏£‡∏±‡∏ö';
            }
            
            if (msg.includes('‡πÄ‡∏ö‡∏£‡∏Å')) {
                return '‡πÄ‡∏ö‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ:\n\n1. ‡∏ú‡πâ‡∏≤‡πÄ‡∏ö‡∏£‡∏Å‡∏≠‡∏≤‡∏à‡∏ö‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î\n2. ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏ö‡∏£‡∏Å‡∏≠‡∏≤‡∏à‡∏£‡∏±‡πà‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢\n3. ‡∏à‡∏≤‡∏ô‡πÄ‡∏ö‡∏£‡∏Å‡∏≠‡∏≤‡∏à‡∏ö‡∏∏‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ\n\n‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö';
            }
            
            if (msg.includes('‡∏à‡∏≠‡∏á') || msg.includes('‡∏Ñ‡∏¥‡∏ß')) {
                return '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:\n- ‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ\n- ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ\n- ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö\n- ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å\n\n‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà "‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ã‡πà‡∏≠‡∏°" ‡∏ö‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö';
            }
            
            return '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏¢‡∏π‡πà ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏Ñ‡∏£‡∏±‡∏ö';
        }
    }
}
</script>
{% endblock %}
