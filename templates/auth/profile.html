{% extends 'base.html' %}

{% block title %}‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå - THE ONE{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8" x-data="{ editing: false, addingMotorcycle: false }">
    <div class="px-4 py-6 sm:px-0">
        <!-- Profile Card -->
        <div class="card mb-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>
                <button @click="editing = !editing" 
                        x-text="editing ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'"
                        :class="editing ? 'btn-secondary' : 'btn-primary'">
                </button>
            </div>
            
            <!-- View Mode -->
            <div x-show="!editing">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                        <p class="text-gray-900">{{ user.username }}</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <p class="text-gray-900">{{ user.email }}</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                        <p class="text-gray-900">{{ user.get_user_type_display }}</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <p class="text-gray-900">{{ user.phone_number|default:"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" }}</p>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                        <p class="text-gray-900">{{ user.address|default:"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" }}</p>
                    </div>
                </div>
                
                <div class="mt-6 flex space-x-4">
                    {% if not user.is_mechanic %}
                    <a href="{% url 'booking_list' %}" class="btn-secondary">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
                    {% else %}
                    <a href="{% url 'mechanic_dashboard' %}" class="btn-secondary">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ä‡πà‡∏≤‡∏á</a>
                    {% endif %}
                </div>
            </div>
            
            <!-- Edit Mode -->
            <div x-show="editing" style="display: none;">
                <form method="POST" action="{% url 'profile' %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_profile">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                            <input type="text" name="username" value="{{ user.username }}" class="input-field" readonly>
                            <p class="text-xs text-gray-500 mt-1">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏î‡πâ</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input type="email" name="email" value="{{ user.email }}" class="input-field" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                            <input type="text" value="{{ user.get_user_type_display }}" class="input-field" readonly>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" name="phone_number" value="{{ user.phone_number }}" class="input-field" placeholder="0812345678">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                            <textarea name="address" rows="3" class="input-field" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡πà‡∏á">{{ user.address }}</textarea>
                        </div>
                        
                        <div class="md:col-span-2 border-t pt-4 mt-2">
                            <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                                    <input type="password" name="current_password" class="input-field" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô">
                                </div>
                                <div></div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                                    <input type="password" name="new_password" class="input-field" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                                    <input type="password" name="confirm_password" class="input-field" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex space-x-4">
                        <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
                        <button type="button" @click="editing = false" class="btn-secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Motorcycles Section (Only for customers) -->
        {% if not user.is_mechanic %}
        <div class="card">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">üèçÔ∏è ‡∏£‡∏ñ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                <button @click="addingMotorcycle = !addingMotorcycle" 
                        x-text="addingMotorcycle ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : '+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ'"
                        :class="addingMotorcycle ? 'btn-secondary' : 'btn-primary'">
                </button>
            </div>

            <!-- Add Motorcycle Form -->
            <div x-show="addingMotorcycle" x-transition class="mb-6 p-4 bg-gradient-to-r from-red-50 to-amber-50 rounded-lg" style="display: none;">
                <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà</h3>
                <form method="POST" action="{% url 'profile' %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="add_motorcycle">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ *</label>
                            <input type="text" name="brand" class="input-field" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Honda, Yamaha">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∏‡πà‡∏ô *</label>
                            <input type="text" name="model" class="input-field" required placeholder="‡πÄ‡∏ä‡πà‡∏ô CBR650R, MT-09">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏µ *</label>
                            <input type="number" name="year" class="input-field" required min="1990" max="2030" placeholder="2024">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ã‡∏µ‡∏ã‡∏µ *</label>
                            <input type="number" name="cc" class="input-field" required min="150" placeholder="650">
                        </div>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                        <button type="button" @click="addingMotorcycle = false" class="btn-secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </form>
            </div>

            <!-- Motorcycle List -->
            {% if motorcycles %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for motorcycle in motorcycles %}
                <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-primary-300 hover:shadow-lg transition-all duration-300">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-gray-900">{{ motorcycle.brand }} {{ motorcycle.model }}</h3>
                        <span class="badge-gold">{{ motorcycle.cc }} cc</span>
                    </div>
                    <div class="space-y-1 text-sm text-gray-600">
                        <p><strong>‡∏õ‡∏µ:</strong> {{ motorcycle.year }}</p>
                        <p><strong>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> {{ motorcycle.created_at|date:"d/m/Y" }}</p>
                    </div>
                    <form method="POST" action="{% url 'profile' %}" class="mt-3" onsubmit="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ?')">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete_motorcycle">
                        <input type="hidden" name="motorcycle_id" value="{{ motorcycle.id }}">
                        <button type="submit" class="text-red-600 hover:text-red-800 text-sm font-medium">üóëÔ∏è ‡∏•‡∏ö</button>
                    </form>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-12 bg-gray-50 rounded-lg">
                <p class="text-gray-500 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ</p>
                <button @click="addingMotorcycle = true" class="btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡πÅ‡∏£‡∏Å</button>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
