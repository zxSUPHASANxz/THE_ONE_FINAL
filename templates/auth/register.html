{% extends 'base.html' %}

{% block title %}‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ - THE ONE{% endblock %}

{% block content %}
<style>
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }
    .shake {
        animation: shake 0.4s ease-in-out;
    }
    .strength-bar {
        transition: all 0.3s ease;
    }
    .spinner {
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        width: 20px;
        height: 20px;
        animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .input-valid {
        border-color: #10b981 !important;
        background-color: #f0fdf4 !important;
    }
    .input-invalid {
        border-color: #ef4444 !important;
        background-color: #fef2f2 !important;
    }
    .password-requirement {
        transition: all 0.2s ease;
        font-weight: 500;
    }
    .requirement-met {
        color: #10b981;
        font-weight: 600;
    }
    .requirement-unmet {
        color: #6b7280;
    }
</style>

<div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-gradient-to-br from-gray-50 to-gray-100">
    <div class="max-w-2xl w-full space-y-8">
        <div class="bg-white rounded-2xl shadow-2xl p-8 border-2 border-gray-200">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üìù</div>
                <h2 class="text-3xl font-extrabold bg-gradient-to-r from-red-600 to-yellow-500 bg-clip-text text-transparent">
                    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ THE_ONE
                </h2>
                <p class="mt-2 text-sm text-gray-600">
                    ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏Ñ‡πå
                </p>
            </div>

            <!-- Alert Messages -->
            <div id="alertContainer" class="mb-6">
                {% if messages %}
                    {% for message in messages %}
                        <div class="rounded-lg p-4 mb-3 {% if message.tags == 'success' %}bg-green-100 border-2 border-green-400 text-green-800{% elif message.tags == 'error' %}bg-red-100 border-2 border-red-400 text-red-800{% else %}bg-blue-100 border-2 border-blue-400 text-blue-800{% endif %}">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">{% if message.tags == 'success' %}‚úÖ{% elif message.tags == 'error' %}‚ùå{% else %}‚ÑπÔ∏è{% endif %}</span>
                                <p class="font-semibold">{{ message }}</p>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>

                <form id="registerForm" class="space-y-5" method="POST">
                    {% csrf_token %}

                    <!-- Username Field -->
                    <div>
                        <label for="username" class="block text-sm font-bold text-gray-900 mb-2">
                            ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ <span class="text-red-600">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="username" 
                            name="username"
                            class="appearance-none rounded-lg relative block w-full px-4 py-3 border-2 border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 font-medium"
                            placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£"
                            required
                            minlength="3"
                            maxlength="150"
                            autocomplete="username"
                        >
                        <p class="mt-1 text-xs text-gray-600 font-medium" id="usernameHelp">
                            ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞ @/./+/-/_ ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                        </p>
                        <p class="mt-1 text-xs text-red-600 font-semibold hidden" id="usernameError"></p>
                    </div>

                    <!-- Email Field -->
                    <div>
                        <label for="email" class="block text-sm font-bold text-gray-900 mb-2">
                            ‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span class="text-red-600">*</span>
                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email"
                            class="appearance-none rounded-lg relative block w-full px-4 py-3 border-2 border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 font-medium"
                            placeholder="example@email.com"
                            required
                            autocomplete="email"
                        >
                        <p class="mt-1 text-xs text-red-600 font-semibold hidden" id="emailError"></p>
                    </div>

                    <!-- First Name Field -->
                    <div>
                        <label for="first_name" class="block text-sm font-bold text-gray-900 mb-2">
                            ‡∏ä‡∏∑‡πà‡∏≠ <span class="text-red-600">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="first_name" 
                            name="first_name"
                            class="appearance-none rounded-lg relative block w-full px-4 py-3 border-2 border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 font-medium"
                            placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á"
                            required
                            maxlength="150"
                            autocomplete="given-name"
                        >
                        <p class="mt-1 text-xs text-red-600 font-semibold hidden" id="firstNameError"></p>
                    </div>

                    <!-- Last Name Field -->
                    <div>
                        <label for="last_name" class="block text-sm font-bold text-gray-900 mb-2">
                            ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="text-red-600">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="last_name" 
                            name="last_name"
                            class="appearance-none rounded-lg relative block w-full px-4 py-3 border-2 border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 font-medium"
                            placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
                            required
                            maxlength="150"
                            autocomplete="family-name"
                        >
                        <p class="mt-1 text-xs text-red-600 font-semibold hidden" id="lastNameError"></p>
                    </div>

                    <!-- Phone Number Field -->
                    <div>
                        <label for="phone_number" class="block text-sm font-bold text-gray-900 mb-2">
                            ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
                        </label>
                        <input 
                            type="tel" 
                            id="phone_number" 
                            name="phone_number"
                            class="appearance-none rounded-lg relative block w-full px-4 py-3 border-2 border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 font-medium"
                            placeholder="0812345678 (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)"
                            maxlength="10"
                            pattern="[0-9]{10}"
                            autocomplete="tel"
                        >
                        <p class="mt-1 text-xs text-gray-600 font-medium">
                            ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ 10 ‡∏´‡∏•‡∏±‡∏Å (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
                        </p>
                        <p class="mt-1 text-xs text-red-600 font-semibold hidden" id="phoneError"></p>
                    </div>

                    <!-- User Type Field -->
                    <div>
                        <label for="user_type" class="block text-sm font-bold text-gray-900 mb-2">
                            ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ <span class="text-red-600">*</span>
                        </label>
                        <select 
                            id="user_type" 
                            name="user_type"
                            class="appearance-none rounded-lg relative block w-full px-4 py-3 border-2 border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 bg-white font-medium"
                            required
                        >
                            <option value="" class="text-gray-500">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ --</option>
                            <option value="customer" class="text-gray-900 font-semibold">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Customer)</option>
                            <option value="mechanic" class="text-gray-900 font-semibold">‡∏ä‡πà‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏° (Mechanic)</option>
                        </select>
                        <p class="mt-1 text-xs text-red-600 font-semibold hidden" id="userTypeError"></p>
                    </div>

                    <!-- Password Field -->
                    <div>
                        <label for="password" class="block text-sm font-bold text-gray-900 mb-2">
                            ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <span class="text-red-600">*</span>
                        </label>
                        <div class="relative">
                            <input 
                                type="password" 
                                id="password" 
                                name="password"
                                class="appearance-none rounded-lg relative block w-full px-4 py-3 pr-12 border-2 border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 font-medium"
                                placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£"
                                required
                                minlength="8"
                                autocomplete="new-password"
                            >
                            <button 
                                type="button" 
                                id="togglePassword"
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-gray-900 focus:outline-none text-xl"
                                tabindex="-1"
                            >
                                <span id="passwordIcon">üëÅÔ∏è</span>
                            </button>
                        </div>
                        
                        <!-- Password Strength Meter -->
                        <div class="mt-3">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-xs font-bold text-gray-700">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:</span>
                                <span id="strengthText" class="text-xs font-extrabold text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3 border border-gray-300">
                                <div 
                                    id="strengthBar" 
                                    class="strength-bar h-full rounded-full bg-gray-300" 
                                    style="width: 0%"
                                ></div>
                            </div>
                        </div>

                        <!-- Password Requirements -->
                        <div class="mt-3 space-y-1 text-xs bg-gray-50 p-3 rounded-lg border border-gray-200">
                            <p class="password-requirement requirement-unmet" id="req-length">
                                <span id="icon-length" class="font-bold">‚óã</span> ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
                            </p>
                            <p class="password-requirement requirement-unmet" id="req-letter">
                                <span id="icon-letter" class="font-bold">‚óã</span> ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (a-z, A-Z)
                            </p>
                            <p class="password-requirement requirement-unmet" id="req-number">
                                <span id="icon-number" class="font-bold">‚óã</span> ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (0-9)
                            </p>
                            <p class="password-requirement requirement-unmet" id="req-special">
                                <span id="icon-special" class="font-bold">‚óã</span> ‡∏°‡∏µ‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏© (!@#$%^&*)
                            </p>
                        </div>
                        <p class="mt-2 text-xs text-red-600 font-semibold hidden" id="passwordError"></p>
                    </div>

                    <!-- Confirm Password Field -->
                    <div>
                        <label for="password2" class="block text-sm font-bold text-gray-900 mb-2">
                            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <span class="text-red-600">*</span>
                        </label>
                        <div class="relative">
                            <input 
                                type="password" 
                                id="password2" 
                                name="password2"
                                class="appearance-none rounded-lg relative block w-full px-4 py-3 pr-12 border-2 border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 font-medium"
                                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á"
                                required
                                minlength="8"
                                autocomplete="new-password"
                            >
                            <button 
                                type="button" 
                                id="togglePassword2"
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-gray-900 focus:outline-none text-xl"
                                tabindex="-1"
                            >
                                <span id="password2Icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                        <p class="mt-1 text-xs text-red-600 font-semibold hidden" id="password2Error"></p>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="flex items-start bg-gray-50 p-4 rounded-lg border-2 border-gray-200">
                        <input 
                            type="checkbox" 
                            id="terms" 
                            name="terms"
                            class="mt-1 w-5 h-5 text-red-600 border-gray-400 rounded focus:ring-2 focus:ring-red-500"
                            required
                        >
                        <label for="terms" class="ml-3 text-sm text-gray-900 font-medium">
                            ‡∏â‡∏±‡∏ô‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö <a href="/terms" class="text-red-600 hover:text-red-700 hover:underline font-bold" target="_blank">‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a> 
                            ‡πÅ‡∏•‡∏∞ <a href="/privacy" class="text-red-600 hover:text-red-700 hover:underline font-bold" target="_blank">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a>
                            <span class="text-red-600">*</span>
                        </label>
                    </div>
                    <p class="text-xs text-red-600 font-semibold hidden" id="termsError"></p>

                    <!-- Submit Button -->
                    <button 
                        type="submit" 
                        id="submitBtn"
                        class="group relative w-full flex justify-center py-4 px-4 border border-transparent text-base font-extrabold rounded-lg text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-200 transform hover:scale-105 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    >
                        <span id="submitText">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</span>
                        <span id="submitSpinner" class="spinner mx-auto hidden"></span>
                    </button>
                </form>

                <!-- Login Link -->
                <div class="mt-6 text-center">
                    <p class="text-sm text-gray-700 font-medium">
                        ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? 
                        <a href="{% url 'users:login' %}" class="font-bold text-red-600 hover:text-red-700 hover:underline">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle Password Visibility
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('password');
    const passwordIcon = document.getElementById('passwordIcon');

    togglePassword.addEventListener('click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        passwordIcon.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
    });

    // Toggle Confirm Password Visibility
    const togglePassword2 = document.getElementById('togglePassword2');
    const password2Input = document.getElementById('password2');
    const password2Icon = document.getElementById('password2Icon');

    togglePassword2.addEventListener('click', function() {
        const type = password2Input.getAttribute('type') === 'password' ? 'text' : 'password';
        password2Input.setAttribute('type', type);
        password2Icon.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
    });

    // Password Strength Checker
    const password = document.getElementById('password');
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');
    
    password.addEventListener('input', function() {
        checkPasswordStrength(this.value);
    });

    function checkPasswordStrength(password) {
        let strength = 0;
        const requirements = {
            length: password.length >= 8,
            letter: /[a-zA-Z]/.test(password),
            number: /[0-9]/.test(password),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
        };

        // Update requirement indicators
        Object.keys(requirements).forEach(req => {
            const element = document.getElementById(`req-${req}`);
            const icon = document.getElementById(`icon-${req}`);
            if (requirements[req]) {
                element.classList.add('requirement-met');
                element.classList.remove('requirement-unmet');
                icon.textContent = '‚úì';
                strength++;
            } else {
                element.classList.remove('requirement-met');
                element.classList.add('requirement-unmet');
                icon.textContent = '‚óã';
            }
        });

        // Update strength bar
        const strengthPercent = (strength / 4) * 100;
        strengthBar.style.width = strengthPercent + '%';

        if (strength === 0) {
            strengthBar.classList.remove('bg-red-500', 'bg-yellow-500', 'bg-green-500');
            strengthBar.classList.add('bg-gray-300');
            strengthText.textContent = '‡πÑ‡∏°‡πà‡∏°‡∏µ';
            strengthText.className = 'text-xs font-extrabold text-gray-600';
        } else if (strength <= 2) {
            strengthBar.classList.remove('bg-gray-300', 'bg-yellow-500', 'bg-green-500');
            strengthBar.classList.add('bg-red-500');
            strengthText.textContent = '‡∏≠‡πà‡∏≠‡∏ô';
            strengthText.className = 'text-xs font-extrabold text-red-600';
        } else if (strength === 3) {
            strengthBar.classList.remove('bg-gray-300', 'bg-red-500', 'bg-green-500');
            strengthBar.classList.add('bg-yellow-500');
            strengthText.textContent = '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á';
            strengthText.className = 'text-xs font-extrabold text-yellow-600';
        } else {
            strengthBar.classList.remove('bg-gray-300', 'bg-red-500', 'bg-yellow-500');
            strengthBar.classList.add('bg-green-500');
            strengthText.textContent = '‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á';
            strengthText.className = 'text-xs font-extrabold text-green-600';
        }
    }

    // Form validation
    const form = document.getElementById('registerForm');
    form.addEventListener('submit', function(e) {
        const password1 = document.getElementById('password').value;
        const password2 = document.getElementById('password2').value;

        // Check if passwords match (client-side validation)
        if (password1 !== password2) {
            e.preventDefault();
            document.getElementById('password2Error').textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
            document.getElementById('password2Error').classList.remove('hidden');
            document.getElementById('password2').classList.add('input-invalid');
            return false;
        }

        // Clear error
        document.getElementById('password2Error').classList.add('hidden');
        document.getElementById('password2').classList.remove('input-invalid');

        // Show loading state
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const submitSpinner = document.getElementById('submitSpinner');

        submitBtn.disabled = true;
        submitText.classList.add('hidden');
        submitSpinner.classList.remove('hidden');

        // Let form submit naturally (don't prevent default)
        return true;
    });
});
</script>
{% endblock %}
